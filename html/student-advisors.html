<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Asesores | UNAM</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/notifications.css">
</head>
<body>
    
    <!-- Header -->
    <header class="main-header">
        <div class="header-left">
            <div class="brand-logo" onclick="window.location.href='index.html'" style="cursor: pointer;">
                <img src="../img/logo.png" alt="UNAM" style="height: 45px; width: auto; margin-right: 8px;">
                <span>UNAM</span>
            </div>
            <div class="app-version">
                <span>Panel del Estudiante</span>
            </div>
        </div>
        <div class="header-right">
             <div class="header-actions">
                 <!-- Notification Bell -->
                 <div class="notification-wrapper">
                     <i class="ri-notification-3-line notification-icon" id="btn-notifications"></i>
                     <span class="badge-count">0</span>
                     <!-- Dropdown -->
                     <div class="notification-dropdown hidden" id="notification-dropdown">
                        <div class="notif-header">
                            <div class="notif-title">Notificaciones</div>
                            <div class="notif-filters">
                                <span class="filter-pill active" id="filter-all">Todas</span>
                                <span class="filter-pill" id="filter-unread">No leídas</span>
                            </div>
                        </div>
                        <div class="notif-list" id="notif-list"></div>
                     </div>
                 </div>
            </div>
            <div class="user-nav">
                <span id="current-user-name">Estudiante</span>
                <i class="ri-account-circle-line"></i>
                <i class="ri-logout-box-r-line" id="btn-logout" style="cursor: pointer;" title="Cerrar Sesión"></i>
            </div>
        </div>
    </header>

    <div class="app-body">
        <!-- Sidebar -->
        <aside class="sidebar">
            <a href="student-requests.html" class="nav-item">
                <i class="ri-file-list-3-line"></i>
                <span>Solicitudes</span>
            </a>
            <a href="student-advisors.html" class="nav-item active">
                <i class="ri-user-star-line"></i>
                <span>Asesores</span>
            </a>
            <a href="student-kanban.html" class="nav-item">
                <i class="ri-artboard-line"></i>
                <span>Tablero / Avance</span>
            </a>
            <a href="chat.html" class="nav-item">
                <i class="ri-chat-1-line"></i>
                <span>Mensajes</span>
            </a>
            <!-- Links for other roles will be hidden by app.js -->
            <a href="schools.html" class="nav-item">
                <i class="ri-building-2-line"></i>
                <span>Escuelas</span>
            </a>
            <a href="jurados.html" class="nav-item">
                <i class="ri-scales-3-line"></i>
                <span>Jurados</span>
            </a>
            <a href="advisors.html" class="nav-item">
                <i class="ri-user-star-line"></i>
                <span>Gestionar Asesores</span>
            </a>
            <a href="students.html" class="nav-item">
                <i class="ri-group-line"></i>
                <span>Estudiantes</span>
            </a>
            <a href="admin.html" class="nav-item">
                <i class="ri-admin-line"></i>
                <span>Admin</span>
            </a>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            
            <section class="welcome-card" style="margin-bottom: 2rem;">
                <div class="welcome-user">
                    <h2>Asesores Disponibles</h2>
                    <p>Encuentra asesores y co-asesores para tu proyecto de tesis.</p>
                </div>
            </section>

            <!-- Advisors List -->
            <section class="crud-section">
                <div class="crud-header">
                    <div class="crud-title">
                        <i class="ri-search-eye-line"></i>
                        <span>Directorio de Asesores</span>
                    </div>
                </div>

                <div class="controls-bar">
                    <div class="search-box">
                        <i class="ri-search-line"></i>
                        <input type="text" id="student-search-advisor" placeholder="Buscar por nombre o especialidad...">
                    </div>
                    <div class="filter-box">
                        <select id="student-filter-career">
                            <option value="all">Todas las carreras</option>
                            <option value="Ingeniería de Sistemas e Informática">Ing. Sistemas</option>
                            <option value="Ingeniería Civil">Ing. Civil</option>
                            <option value="Ingeniería de Minas">Ing. Minas</option>
                            <option value="Ingeniería Agroindustrial">Ing. Agroindustrial</option>
                            <option value="Ingeniería Ambiental">Ing. Ambiental</option>
                            <option value="Gestión Pública y Desarrollo Social">Gestión Pública</option>
                        </select>
                    </div>
                </div>

                <div class="list-container" id="student-advisors-list">
                    <!-- Table Injected via JS -->
                </div>
            </section>

        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <span id="toast-msg">Operación exitosa</span>
    </div>

    <script src="../js/notifications.js"></script>
    <script src="../js/app.js"></script>
    <script src="../js/student-logic.js"></script>
    <script>
        // Fallback / Force Render Script
        window.addEventListener('load', function() {
            setTimeout(() => {
                const container = document.getElementById('student-advisors-list');
                if(!container) return;

                // 1. Check & Seed/Update Data
                let advisors = JSON.parse(localStorage.getItem('nexus_advisors')) || [];
                
                // Ensure Super Asesor is up to date
                const superIndex = advisors.findIndex(a => a.user === 'superac');
                // Set status to 'inactive' to reflect requested unavailability due to active assignment
                const superData = { id: 'superac', user: 'superac', name: 'Super Asesor', specialty: 'Especialidad', career: 'Ingeniería de Sistemas e Informática', status: 'inactive', type: 'Asesor' };
                
                if (superIndex !== -1) {
                    // Update existing
                    advisors[superIndex] = { ...advisors[superIndex], ...superData };
                    // Preserve status if manually changed?
                    // The user wants to see the change, so I'll force it, but maybe respect status if checking availability?
                    // User request: "cambiar a super asesor como asesor..." implies type/specialty.
                } else {
                    // Add if missing
                    advisors.unshift(superData);
                }
                
                if(advisors.length <= 1) { // If only superac or empty, seed others
                     if(!advisors.find(a => a.user === 'adv2')) advisors.push({ id: 'adv2', user: 'adv2', name: 'Juan Perez', specialty: 'Gestión de Proyectos', career: 'Ingeniería Civil', status: 'active', type: 'Contratado' });
                     if(!advisors.find(a => a.user === 'adv3')) advisors.push({ id: 'adv3', user: 'adv3', name: 'Maria Rodriguez', specialty: 'Medio Ambiente', career: 'Ingeniería Ambiental', status: 'active', type: 'Nombrado' });
                }

                localStorage.setItem('nexus_advisors', JSON.stringify(advisors));

                // 2. Check if already rendered
                if(container.querySelector('table')) return;

                // 3. Render
                console.log("Force rendering advisors list...");
                
                if (advisors.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 2rem;"><p>No se encontraron asesores.</p></div>';
                    return;
                }

                const table = document.createElement('table');
                table.className = 'student-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Carrera</th>
                            <th>Especialidad</th>
                            <th>Tipo</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                `;

                const tbody = table.querySelector('tbody');

                advisors.forEach(advisor => {
                     // Filter visuals if needed, but show all for now
                    const isActive = advisor.status === 'active' || advisor.status === undefined; 
                    const statusBadge = isActive 
                        ? '<span class="card-badge" style="background:#e8f5e9; color:#2e7d32; font-size:0.75rem;">Disponible</span>' 
                        : '<span class="card-badge" style="background:#f5f5f5; color:#757575; font-size:0.75rem;">No Disponible</span>';

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="font-weight: 500;">
                            ${advisor.name}
                            <div style="margin-top:4px;">${statusBadge}</div>
                        </td>
                        <td style="font-size: 0.9rem;">${advisor.career || '-'}</td>
                        <td style="font-size: 0.9rem; color: #555;">${advisor.specialty || '-'}</td>
                        <td><span class="card-badge badge-design" style="font-size: 0.8rem; background: #e0f2f1; color: #00695c;">${advisor.type || 'Docente'}</span></td>
                    `;
                    tbody.appendChild(tr);
                });

                container.innerHTML = ''; // clear loading or empty
                container.appendChild(table);

            }, 500); // Small delay to allow main logic to try first
        });
    </script>
</body>
</html>

